<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ورود به سامانه</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">

    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/bzamani/bootstrap.css">

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">

    <!-- Main CSS -->
    <link rel="stylesheet" href="assets/bzamani/style-public.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.min.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->
    <!-- jQuery -->
    <script src="/app/assets/bzamani/jquery-1.10.2.min.js"></script>
    <script src="/app/assets/bzamani/jquery.cookie.js"></script>

    <!-- sweet alert -->
    <script type="text/javascript" src="/app/assets/bzamani/components/sweetalert/sweetalert2.min.js"></script>
    <script type="text/javascript" src="/app/assets/bzamani/components/sweetalert/sweetAlertConfirm.js"></script>
    <link rel="stylesheet" href="/app/assets/bzamani/components/sweetalert/sweetalert2.min.css">
    <!-- /sweet alert -->
    <script src='https://www.google.com/recaptcha/api.js'></script>
    <script>
        var contextPath = "/app";
        $(function () {
            localStorage.clear();

            $.removeCookie('Authorization', {path: '/'});

            $('#txtUsername').keydown(function (e) {
                if (e.which == 13)  // the enter key code
                    login();
            });

            $('#txtPassword').keydown(function (e) {
                if (e.which == 13)  // the enter key code
                    login();
            });

        });

        function login() {
            if ($('#txtUsername').val() != '' && $('#txtPassword').val() != '') {
                $.ajax({
                    url: contextPath + "/authenticate",
                    contentType: "application/json;charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify({
                        "g-recaptcha-response": $('#g-recaptcha-response').val(),
                        "username": $('#txtUsername').val(),
                        "password": $('#txtPassword').val()
                    }),
                    type: 'POST',
                    success: function (res) {
                        localStorage.setItem("authenticatedUserFullName", res.personel.firstname + " " + res.personel.lastname);
                        if (res.personel.fileCode != null)
                            localStorage.setItem("authenticatedUserImageFileCode", res.personel.fileCode);
                        $.cookie('Authorization', "Bearer-" + res.token, {expires: 1, path: '/'});
                        if(document.referrer && !document.referrer.includes('/register.html'))
                            document.location.href = document.referrer;
                        else
                            document.location.href = contextPath + "/index.html";
                    },
                    error: function (err) {
                        $('#g-recaptcha-response').val('');
                        grecaptcha.reset();
                        if (err.responseText.includes("Bad credentials")) {
                            showMessage("نام کاربری یا کلمه عبور اشتباه است.", "", "error");
                        } else if (err.responseText.includes("The response parameter is missing")) {
                            showMessage("اشکال در کپچا. نکنه شما ربات هستید؟", "", "error");
                        } else
                            showMessage(err.responseJSON.message, "", "error");
                    }
                });
            } else
                $('#txtUsername').focus();
        }

    </script>
    <style>
        .rc-anchor-container {
            width: 100% !important;
        }
    </style>
</head>
<body class="account-page">

<!-- Main Wrapper -->
<div class="main-wrapper">

    <!-- Page Content -->
    <div class="content">
        <div class="container-fluid">

            <div class="row">
                <div class="col-md-8 offset-md-2">

                    <!-- Login  محتوای تب -->
                    <div class="account-content">
                        <div class="row align-items-center justify-content-center">
                            <div class="col-md-7 col-lg-6 login-left">
                                <img src="assets/img/login-banner.png" class="img-fluid" alt="Doccure Login">
                            </div>
                            <div class="col-md-12 col-lg-6 login-right">
                                <div class="login-header">
                                    <h3> ورود به <span>سامانه</span></h3>
                                </div>
                                <input type="hidden" id="g-recaptcha-response" name="g-recaptcha-response"/>
                                <div class="form-group form-focus">
                                    <input type="text" class="form-control floating" id="txtUsername" dir="ltr">
                                    <label class="focus-label">نام کاربری</label>
                                </div>
                                <div class="form-group form-focus">
                                    <input type="password" class="form-control floating" id="txtPassword" dir="ltr">
                                    <label class="focus-label">رمزعبور</label>
                                </div>
                                <div class="form-group form-focus">
                                    <div class="g-recaptcha" data-sitekey="6LfAqRYaAAAAADjef9Myz5oOGGa_1ykOGiHLLa6_">
                                    </div>
                                </div>
                                <div class="text-right">
                                    <a class="forgot-link" href="forgot-password.html">رمزعبورم رو فراموش کردم!</a>
                                </div>
                                <button class="btn btn-primary btn-block btn-lg login-btn" onclick="login()">‌ورود
                                </button>
                                <div class="text-center dont-have">
                                    حساب کاربری ندارم. مایل به
                                    <a href="register.html">ثبت نام</a>
                                    هستم.
                                </div>
                                <div class="text-center dont-have">
                                    <a href="index.html">بازگشت به صفحه اصلی</a>
                                </div>
                                <div class="text-center dont-have">
                                    <span>شماره نسخه: 1.0</span>&nbsp;&nbsp;&nbsp;<span>تاریخ بروزرسانی: 1399/10/16</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /Login  محتوای تب -->

                </div>
            </div>

        </div>

    </div>
    <!-- /Page Content -->

</div>
<!-- /Main Wrapper -->

<!-- Bootstrap Core JS -->
<script src="assets/admin/chart/popper.min.js"></script>
<script src="assets/bzamani/bootstrap.min.js"></script>

<!-- Custom JS -->
<script src="assets/admin/chart/script.js"></script>

</body>
</html>
