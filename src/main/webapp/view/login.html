<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>مدیک</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">

    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap-rtl/css/bootstrap.min.css">

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">

    <!-- Main CSS -->
    <link rel="stylesheet" href="assets/css/style.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.min.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->
    <!-- jQuery -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.cookie.js"></script>
    <script>
        var contextPath = "/app";
        $(function () {
            localStorage.clear();
            $.removeCookie('Authorization', { path: '/' });
        });

        function login() {
            if ($('#txtUsername').val() != '' && $('#txtPassword').val() != '') {
                $.ajax({
                    url: contextPath + "/authenticate",
                    contentType: "application/json;charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify({
                        "username": $('#txtUsername').val(),
                        "password": $('#txtPassword').val()
                    }),
                    type: 'POST',
                    success: function (res) {
                        localStorage.setItem("username", res.username);
                        //localStorage.setItem("token", res.token);
                        $.cookie('Authorization', "Bearer-" + res.token, {expires: 1, path: '/'});
                        if (res.authorities[0].authority == "ROLE_ADMIN")
                            document.location.href = contextPath + "/view/admin/index.html";
                        else if (res.authorities[0].authority == "ROLE_DOCTOR")
                            document.location.href = contextPath + "/view/doctor-dashboard.html";
                        else if (res.authorities[0].authority == "ROLE_PATIENT")
                            document.location.href = contextPath + "/view/patient-dashboard.html";
                    },
                    error: function (err) {
                        if (err.responseText.includes("Bad credentials")) {
                            alert("نام کاربری یا کلمه عبور اشتباه است.");
                        }
                        ;
                    }
                });
            } else
                $('#txtUsername').focus();
        }
    </script>

</head>
<body class="account-page">
<!-- Main Wrapper -->
<div class="main-wrapper">

    <!-- Page Content -->
    <div class="content">
        <div class="container-fluid">

            <div class="row">
                <div class="col-md-8 offset-md-2">

                    <!-- Login  محتوای تب -->
                    <div class="account-content">
                        <div class="row align-items-center justify-content-center">
                            <div class="col-md-7 col-lg-6 login-left">
                                <img src="assets/img/login-banner.png" class="img-fluid" alt="Doccure Login">
                            </div>
                            <div class="col-md-12 col-lg-6 login-right">
                                <div class="login-header">
                                    <h3> ورود به <span>مدیک</span></h3>
                                </div>
                                <div class="form-group form-focus">
                                    <input type="text" class="form-control floating" id="txtUsername">
                                    <label class="focus-label">نام کاربری</label>
                                </div>
                                <div class="form-group form-focus">
                                    <input type="password" class="form-control floating" id="txtPassword">
                                    <label class="focus-label">رمزعبور</label>
                                </div>
                                <div class="text-right">
                                    <a class="forgot-link" href="forgot-password.html">فراموشی رمزعبور</a>
                                </div>
                                <button class="btn btn-primary btn-block btn-lg login-btn" onclick="login()">‌ورود
                                </button>
                                <div class="text-center dont-have">
                                    اکانت ندارم. مایل به
                                    <a href="register.html">ثبت نام</a>
                                    هستم.
                                </div>
                                <div class="text-center dont-have">
                                    <a href="index.html">بازگشت به صفحه اصلی</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /Login  محتوای تب -->

                </div>
            </div>

        </div>

    </div>
    <!-- /Page Content -->

</div>
<!-- /Main Wrapper -->

<!-- Bootstrap Core JS -->
<script src="assets/js/popper.min.js"></script>
<script src="assets/plugins/bootstrap-rtl/js/bootstrap.min.js"></script>

<!-- Custom JS -->
<script src="assets/js/script.js"></script>

</body>
</html>